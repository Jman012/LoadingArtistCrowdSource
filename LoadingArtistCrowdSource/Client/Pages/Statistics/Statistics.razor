@page "/statistics"
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject Services.LACSApi Api

@if (_isLoading)
{
	<Spinner></Spinner>
}
else
{
	<Container>
		<Row>
			<Column>
				<h1>Statistics</h1>

				<h3>Overall Comic Integrity</h3>
				<Progress>
					<ProgressBar Value="_overallIntegrity">
						@(_overallIntegrity)%
					</ProgressBar>
				</Progress>

				<h3>Integrity by Year</h3>
				@foreach (var year in _stats.IntegrityByYear.Keys)
				{
					<h4>@year</h4>
					<Progress>
						<ProgressBar Value="(int)Math.Floor(_stats.IntegrityByYear[year] * 100.0)">
							@((int)Math.Floor(_stats.IntegrityByYear[year] * 100.0))%
						</ProgressBar>
					</Progress>
				}
			</Column>
		</Row>
	</Container>
}

@code {
	private bool _isLoading;
	private StatisticsViewModel _stats = new StatisticsViewModel();

	private int _overallIntegrity => (int)Math.Floor(_stats.OverallIntegrity * 100.0);

	protected override async Task OnInitializedAsync()
	{
		try
		{
			_isLoading = true;
			_stats = await Api.GetStatistics();
			_isLoading = false;
		}
		catch (AccessTokenNotAvailableException ex)
		{
			ex.Redirect();
			return;
		}
		await base.OnInitializedAsync();
	}
}